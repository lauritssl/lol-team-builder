/*
pmkr.components v0.0.0
https://github.com/m59peacemaker/angular-pmkr-components
License: MIT
Author: Johnny Hauser
File created: 9.16.2014
*/

angular.module("pmkr.components",["pmkr.components.filters","pmkr.components.services","pmkr.components.directives"]),angular.module("pmkr.components.directives",["pmkr.pristineOriginal","pmkr.validateCustom"]),angular.module("pmkr.components.filters",["pmkr.offset","pmkr.partition","pmkr.shuffle","pmkr.slugify","pmkr.stripTags","pmkr.spaceSentences","pmkr.limitEllipsis"]),angular.module("pmkr.components.services",["pmkr.debounce","pmkr.memoize","pmkr.filterStabilize","pmkr.rethrowException"]),angular.module("pmkr.pristineOriginal",[]).directive("pmkrPristineOriginal",[function(){var e={restrict:"A",require:"ngModel",link:function(e,t,n,o){var r={caseSensitive:!0},i=e.$eval(n.pmkrPristineOriginal);i=angular.extend(r,i);var a=null;e.$watch(function(){return o.$viewValue},function(e){null===a&&(a=o.$isEmpty(e)?"":e.toString());var t;a===e?t=!0:i.caseSensitive||a.toLowerCase()!==e.toLowerCase()||(t=!0),t&&o.$setPristine()})}};return e}]),angular.module("pmkr.validateCustom",["pmkr.debounce"]).directive("pmkrValidateCustom",["$q","pmkr.debounce",function(e,t){var n={restrict:"A",require:"ngModel",priority:1,link:function(e,n,o,r){function i(e){r.$setValidity(p.name,e),s.valid=f?s.invalid=null:!(s.invalid=!e)}function a(e){return f?void 0:(s.validating=!0,p.fn(e))}function u(e){return p.gate&&(f=p.gate(e,r))?(s.pending=s.validating=!1,i(!0),void 0):(s.pending=!0,s.valid=s.invalid=null,c(e).then(function(t){f||(s.checkedValue=e,i(t),s.pending=s.validating=!1)}),void 0)}var p=e.$eval(o.pmkrValidateCustom),s={pending:!1,validating:!1,checkedValue:null,valid:null,invalid:null};p.props&&(e[p.props]=s);var l=t(a,p.wait),c=t.latest(l);r.$setValidity(p.name,!0);var f;e.$watch(function(){return r.$viewValue},u)}};return n}]),angular.module("pmkr.limitEllipsis",["pmkr.stripTags","pmkr.spaceSentences"]).filter("pmkr.limitEllipsis",["$filter",function(e){function t(e,t,i){if(!e||!e.length)return e;i=i||"...";var a=o(n(e)),u=r(a,t);return u===a?u:u+i}var n=e("pmkr.stripTags"),o=e("pmkr.spaceSentences"),r=e("limitTo");return t}]),angular.module("pmkr.offset",[]).filter("pmkr.offset",[function(){function e(e,t){return e&&e.length?(t=parseInt(t,10),e.slice(t)):e}return e}]),angular.module("pmkr.partition",["pmkr.filterStabilize"]).filter("pmkr.partition",["pmkr.filterStabilize",function(e){var t=e(function(e,t){if(!e||!t)return e;for(var n=[],o=0;o<e.length;o+=t)n.push(e.slice(o,o+t));return n});return t}]),angular.module("pmkr.shuffle",["pmkr.filterStabilize"]).filter("pmkr.shuffle",["pmkr.filterStabilize",function(e){function t(e){for(var t=e.length;0!==t;){var n=Math.floor(Math.random()*t);t-=1;var o=e[t];e[t]=e[n],e[n]=o}return e}var n=e(function(e){return e?"string"==typeof e?(e=e.split(""),t(e),e.join("")):(t(e),void 0):e});return n}]),angular.module("pmkr.slugify",[]).filter("pmkr.slugify",[function(){function e(e){if(!e)return e;var t=e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return t}return e}]),angular.module("pmkr.spaceSentences",[]).filter("pmkr.spaceSentences",[function(){function e(e){if(!e)return e;var t=e.replace(/(\w)([.!?]+)(\w)/gi,"$1$2 $3");return t}return e}]),angular.module("pmkr.stripTags",[]).filter("pmkr.stripTags",function(){function e(e,t,n){if(!e)return e;t=t?t.split(","):"";var o=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,r=e.replace(o,function(e,o){var r=~t.indexOf(o.toLowerCase()),i=n?r:!r,a=i?"":e;return a});return r}return e}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",["$timeout","$q",function(e,t){function n(n,o){function r(){var r=t.defer(),a=this,u=arguments;return e.cancel(i),i=e(function(){r.resolve(n.apply(a,u))},o),r.promise}var i;return r}function o(n,o){function r(){var r=t.defer(),a=this,u=arguments;return i||r.resolve(n.apply(a,u)),e.cancel(i),i=e(function(){i=null},o),r.promise}var i;return r}function r(e){function n(){var n=o=JSON.stringify(arguments),r=t.defer();return e.apply(this,arguments).then(function(e){o===n&&r.resolve(e)},function(e){o===n&&r.reject(e)}),r.promise}var o;return n}var i=function(){return n.apply(this,arguments)};return i.immediate=function(){return o.apply(this,arguments)},i.latest=function(){return r.apply(this,arguments)},i}]),angular.module("pmkr.memoize",[]).factory("pmkr.memoize",[function(){function e(){return t.apply(this,arguments)}function t(e){function t(){var t=[].slice.call(arguments),o=JSON.stringify(t),r=n[o];return r?r:(n[o]=e.apply(this,arguments),n[o])}var n={};return t}return e}]),angular.module("pmkr.filterStabilize",["pmkr.memoize"]).factory("pmkr.filterStabilize",["pmkr.memoize",function(e){function t(t){function n(){var e=[].slice.call(arguments);e=angular.copy(e);var n=t.apply(this,e)||e[0];return n}var o=e(n);return o}return t}]),angular.module("pmkr.rethrowException",[]).provider("pmkr.rethrowException",["$provide",function(e){function t(e){function t(t,n){throw e(t,n),t}return t}this.init=function(){e.decorator("$exceptionHandler",["$delegate",t])},this.$get=function(){}}]),describe("pristineOriginal",function(){var e,t,n,o;beforeEach(module("pmkr.pristineOriginal")),beforeEach(inject(function(r,i){e=r,t=i,t.opts={},n=angular.element('<form name="form"></form>'),o=angular.element('<input name="foo" ng-model="foo" pmkr-pristine-original="opts">'),n.append(o)})),it("should return ngModel to pristine when original value is empty and value becomes empty again",function(){e(n)(t),t.$digest(),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue(""),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "abc" again',function(){t.foo="abc",e(n)(t),t.$digest(),t.form.foo.$setViewValue("123"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "Abc" if `opts.caseSensitive:false`',function(){t.foo="abc",t.opts.caseSensitive=!1,e(n)(t),t.$digest(),t.form.foo.$setViewValue("Abc"),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)})}),describe("validateCustom",function(){var e,t,n,o,r;beforeEach(module("pmkr.validateCustom")),beforeEach(module(["$provide",function(e){n=e,n.factory("pmkr.debounce",function(e){function t(t){return function(){return e.when(t())}}var n=t;return n.latest=t,n})}])),beforeEach(inject(function(n,i){e=n,t=i,o=angular.element('<form name="form"></form>'),r=angular.element('<input name="foo" ng-model="foo">'),o.append(r),t.opts={name:"unique"}})),it("should accept argument object as view string",function(){t.fooValid=function(){},spyOn(t,"fooValid"),r.attr("pmkr-validate-custom","{name:'unique', fn:fooValid}"),e(o)(t),t.$digest(),expect(t.fooValid).toHaveBeenCalled()}),it("should accept argument object from controller",function(){t.opts.fn=function(){},spyOn(t.opts,"fn"),r.attr("pmkr-validate-custom","opts"),e(o)(t),t.$digest(),expect(t.opts.fn).toHaveBeenCalled()}),it("should initially be valid",function(){r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.form.foo.$error.unique).toBeFalsy()}),it("should not call `opts.fn` when gated",function(){t.opts.fn=function(){},t.opts.gate=function(){return!0},spyOn(t.opts,"fn"),r.attr("pmkr-validate-custom","opts"),e(o)(t),t.$digest(),expect(t.opts.fn).not.toHaveBeenCalled()}),it("should be valid when gated",function(){t.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(o)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBeFalsy()}),it("should wrap `opts.fn` in `debounce` and `debounce.latest`",function(){var i=!1,a=!1;n.decorator("pmkr.debounce",function(){var e=function(){i=!0};return e.latest=function(){a=!0},e}),r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(i).toBe(!0),expect(a).toBe(!0)}),it("should be valid when `opts.fn` returns `true`",function(){t.opts.fn=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(o)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBeFalsy()}),it("should set $error[opts.name] `true` when `opts.fn` returns `false`",function(){t.opts.fn=function(){return!1},r.attr("pmkr-validate-custom","opts"),e(o)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!0)}),it("should set `props.pending` `true` while debouncing/validating",function(){n.decorator("pmkr.debounce",function(e){function n(n){return function(){return expect(t.fooProps.pending).toBe(!0),e.when(n())}}var o=n;return o.latest=n,o}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.pending).toBe(!0)},r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.fooProps.pending).toBe(!1),t.$digest(),expect(t.fooProps.pending).toBe(!1)}),it("should set `props.validating` `true` while validating",function(){n.decorator("pmkr.debounce",function(e){function n(n){return function(){return expect(t.fooProps.validating).toBe(!1),e.when(n())}}var o=n;return o.latest=n,o}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.validating).toBe(!0)},r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.fooProps.validating).toBe(!1),t.$digest(),expect(t.fooProps.validating).toBe(!1)}),it("should set `props.pending`,`props.validating` to `false` when gated",function(){t.opts.gate=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.fooProps.pending).toBe(!1),expect(t.fooProps.validating).toBe(!1),t.fooProps.pending=!0,t.fooProps.validating=!0,t.$digest(),expect(t.fooProps.pending).toBe(!1),expect(t.fooProps.validating).toBe(!1)}),it("should set `props.checkedValue` to the most recent checked value",function(){t.opts.fn=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.fooProps.checkedValue).toBe(null),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.fooProps.checkedValue).toBe("abc")}),it("should initially set `props.valid` and `props.invalid` to `null`",function(){t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(o)(t),expect(t.fooProps.valid).toBe(null),expect(t.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to `null` when gated",function(){t.opts.props="fooProps",t.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(o)(t),t.$digest(),expect(t.fooProps.valid).toBe(null),expect(t.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to result after validating",function(){t.opts.fn=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(o)(t),t.$digest(),expect(t.fooProps.valid).toBe(!0),expect(t.fooProps.invalid).toBe(!1)})}),describe("debounce",function(){var e,t;beforeEach(module("pmkr.debounce")),beforeEach(inject(function(t){e=t})),beforeEach(inject(["pmkr.debounce",function(e){t=e}])),describe("(main)",function(){it("stuff",function(){function n(){++o}var o=0,r=t(n,100);r(),r(),expect(o).toBe(0),e.flush(100),expect(o).toBe(1)})})}),describe("memoize",function(){var e;beforeEach(module("pmkr.memoize")),beforeEach(inject(["pmkr.memoize",function(t){e=t}])),it("should return a function that returns the same value when called again with the same arguments",function(){var t=0,n=e(function(){return++t}),o=n();expect(n()).toBe(o),expect(n()).toBe(o),o=n(1),expect(n(1)).toBe(o)}),it("should return a function that returns a new value when called again with different arguments",function(){var t=e(function(e){return e+1}),n=t(1);expect(t(2)).not.toBe(n)})}),describe("filterStabilize",function(){var e,t,n;beforeEach(module("pmkr.filterStabilize")),beforeEach(module(function(t){e=t})),beforeEach(inject(function(e,o){t=o,n=e})),it("is needed to prevent infinite digest when filter is unstable",function(){e.register("testFilter",function(){var e=0;return function(){return++e}});var o=angular.element("<p>{{'abc'|testFilter}}</p>");t(o)(n),expect(n.$digest.bind(n)).toThrow()}),it("stabilizes unstable filter",function(){e.register("testFilter",["pmkr.filterStabilize",function(e){var t=0;return e(function(){return++t})}]);var o=angular.element("<p>{{'abc'|testFilter}}</p>");t(o)(n),expect(n.$digest.bind(n)).not.toThrow()}),it("prevents filter from modifying original input reference",function(){e.register("testFilter",["pmkr.filterStabilize",function(e){return e(function(e){return e[0]="abc",e})}]),n.foo=[1,2,3];var o=angular.element("<p>{{foo|testFilter}}</p>");t(o)(n),n.$digest(),expect(n.foo).toEqual([1,2,3])}),it("makes `return` of input reference optional",function(){e.register("testFilter",["pmkr.filterStabilize",function(e){return e(function(e){e[0]="abc"})}]),n.foo=[1,2,3];var o=angular.element("<p>{{foo|testFilter}}</p>");t(o)(n),n.$digest(),expect(n.$eval(o.text())).toEqual(["abc",2,3])})});
//# sourceMappingURL=components.min.js.map